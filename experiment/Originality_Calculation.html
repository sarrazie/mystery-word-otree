{{ block title }}
    Ergebnisse
{{ endblock }}

{{ block content }}

<style>
    .otree-timer {
        display: none;
    }
    #loading-spinner {
        display: none;
        text-align: center;
        padding: 20px;
        font-size: 16px;
        color: #555;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const voteGroupElement = document.getElementById("vote_group");
        const originalityElement = document.getElementById("originality");
        const nextButton = document.getElementById("next-button");
        const loadingSpinner = document.getElementById("loading-spinner");

        // Funktion zum Senden der Live-Anfrage
        function sendLiveRequest(action) {
            liveSend({ action: action });
        }

        // Funktion zum Anzeigen des Ladeindikators und Zur√ºcksetzen der Fehlermeldung
        function showLoading() {
            originalityElement.innerHTML = "";  // Leeren, um keine Fehlermeldung zu zeigen
            if (loadingSpinner) {
                loadingSpinner.style.display = "block";  // Zeige den Ladeindikator
            }
        }

        // Funktion zum Verbergen des Ladeindikators und Anzeigen einer Fehlermeldung
        function showError(message) {
            if (loadingSpinner) {
                loadingSpinner.style.display = "none";  // Blende den Ladeindikator aus
            }
            originalityElement.innerHTML = message;  // Zeige die Fehlermeldung an
            nextButton.disabled = false;  // Aktiviere den Weiter-Button
        }

        // Initiale Anfrage an den Server, um vote_group abzurufen
        sendLiveRequest('get_vote_group');

        // Der Weiter-Button ist zun√§chst deaktiviert
        nextButton.disabled = true;

        // Empfangen der Daten vom Server
        function liveRecv(data) {

            // √úberpr√ºfe auf das `vote_group`-Attribut
            if (data.vote_group !== undefined) {
                const voteGroup = data.vote_group;

                // Zeige die ausgew√§hlte Hinweisgruppe an
                if (voteGroup === "kein g√ºltiges hinweispaar") {
                    voteGroupElement.innerHTML = "<b>Kein g√ºltiges Hinweispaar</b>";
                } else {
                    voteGroupElement.innerHTML = "<b>" + voteGroup + "</b>";
                }

                // Starte die Originalit√§tsberechnung und zeige den Ladeindikator
                showLoading();
                sendLiveRequest('calculate_originality');
            }

            // √úberpr√ºfe auf das `originality`-Attribut
            if (data.originality !== undefined) {
                const originality = data.originality;

                // Blende den Ladeindikator aus, wenn die Berechnung abgeschlossen ist
                if (loadingSpinner) {
                    loadingSpinner.style.display = "none";
                }

                if (originality !== undefined) {
                    originalityElement.innerHTML = "Originalit√§t: <b>" + originality + "</b>";
                    nextButton.disabled = false;  // Aktiviere den Weiter-Button
                } else {
                    showError("Originalit√§t konnte nicht berechnet werden.");
                }
            }
        }

        // Stelle sicher, dass liveRecv aufgerufen wird, wenn Daten empfangen werden
        window.liveRecv = liveRecv;
    });
</script>

</br>

<p>Das final ausgew√§hlte Hinweispaar Ihrer Gruppe:</p>
<p id="vote_group"></p>
<p id="originality"></p>
</br>

<!-- Ladeanimation -->
<div id="loading-spinner">üîÑ Berechnung l√§uft...</div>

<!-- Weiter-Button bleibt deaktiviert, bis Originalit√§t berechnet wird -->
<button id="next-button" class="otree-btn btn btn-info" disabled>Weiter</button>

{{ endblock }}